<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>åº“å­˜ç®¡ç†</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/layui/css/layui.css" rel="stylesheet">
</head>
<body>

<!--æŸ¥è¯¢å‚æ•°çš„è¡¨å•-->
<form class="layui-form layui-form-pane layui-margin-3">
    <div class="layui-form-item">

        <div class="layui-inline">
            <label class="layui-form-label">è¯å“åç§°</label>
            <div class="layui-input-inline">
                <select name="name" id="name" lay-search>
                    <option value="">æœç´¢æˆ–é€‰æ‹©</option>
                    <option th:each="n : ${nameList}" th:value="${n}" th:text="${n}"></option>
                </select>
            </div>
        </div>

        <div class="layui-inline">
            <label class="layui-form-label">å›½è¯å‡†å­—</label>
            <div class="layui-input-inline">
                <select name="code" id="code" lay-search>
                    <option value="">æœç´¢æˆ–é€‰æ‹©</option>
                    <option th:each="c : ${codeList}" th:value="${c}" th:text="${c}"></option>
                </select>
            </div>
        </div>

        <div class="layui-inline">
            <button class="layui-btn" lay-submit lay-filter="toDo">æœç´¢è¯å“</button>
            <button type="reset" class="layui-btn layui-btn-primary">é‡ç½®</button>

        </div>
    </div>
</form>

<!--æ•°æ®è¡¨æ ¼-->
<div style="padding: 16px;">
    <table class="layui-hide" id="test" lay-filter="test"></table>
</div>

<!--è¡¨æ ¼å†…å®¹å³ç«¯æ“ä½œæŒ‰é’®-->
<script type="text/html" id="toolDemo">
    <div class="layui-clear-space">
        <a class="layui-btn layui-btn-xs" lay-event="output">æŸ¥çœ‹åº“å­˜/å‡ºåº“</a>
    </div>
</script>

<!--è¡¨æ ¼å³ä¸‹è§’åˆ†é¡µæ æŒ‰é’®-->
<script type="text/html" id="my-page-bar">
    <div class="layui-btn-container" style="margin-right: 42px;">
        <button class="layui-btn layui-btn-xs layui-btn-primary" lay-event="ä½œè€…ï¼šå¼ å®ä¸š">ğŸ˜€ğŸ˜€ğŸ˜€ğŸ˜€</button>
    </div>
</script>

<script src="/layui/layui.js"></script>
<script>

    layui.use(['table', 'form', 'layer'], function () {
        let table = layui.table;
        let form = layui.form;
        let layer = layui.layer;

        // æœç´¢æŒ‰é’®äº‹ä»¶
        form.on('submit(toDo)', function (data) {
            let field = data.field; // è·å–è¡¨å•å­—æ®µå€¼

            table.reload('test', {  // è¡¨æ ¼æ•°æ®é‡è½½
                where: {
                    'name': field.name,
                    'code': field.code
                }
            });
            return false; // é˜»æ­¢é»˜è®¤ form è·³è½¬
        });

        // åˆ›å»ºæ¸²æŸ“å®ä¾‹
        table.render({
            elem: '#test',
            url: '/getAllMedicineData',
            css: [ // é‡è®¾å½“å‰è¡¨æ ¼æ ·å¼
                '.layui-table-tool-temp{padding-right: 145px;}'
            ].join(''),
            cellMinWidth: 80,
            page: true,
            limit: 15,
            limits: [15, 30, 50],
            pagebar: '#my-page-bar', // åˆ†é¡µæ æ¨¡æ¿
            cols: [
                [
                    {field: 'id', title: 'è¯å“ç¼–å·'},
                    {field: 'name', title: 'è¯å“åç§°'},
                    {field: 'code', title: 'å›½è¯å‡†å­—', templet: '<div><span class="layui-badge layui-bg-gray">{{= d.code }}</span></div>'},
                    {field: 'compose', title: 'è¯å“æˆåˆ†', hide: true},
                    {field: 'specs', title: 'è¯å“è§„æ ¼'},
                    {field: 'usage', title: 'ç”¨æ³•ç”¨é‡', hide: true},
                    {field: 'image', title: 'è¯å“ç…§ç‰‡', hide: true},
                    {field: 'origin', title: 'ç”Ÿäº§å‚å®¶', minWidth: 400},
                    {fixed: 'right', title: 'ç›¸å…³æ“ä½œ', templet: '#toolDemo', align: 'center'}
                ]
            ],
            error: function (res, msg) {
                console.log(res, msg)
            }
        });

        // åº•éƒ¨åˆ†é¡µæ äº‹ä»¶
        table.on('pagebar(test)', function (obj) {
            var eventValue = obj.event; // è·å¾—æŒ‰é’® lay-event å€¼
            layer.msg(eventValue);
        });

        // è§¦å‘å•å…ƒæ ¼å·¥å…·äº‹ä»¶
        table.on('tool(test)', function (obj) {
            let data = obj.data; // è·å¾—å½“å‰è¡Œæ•°æ®

            if (obj.event === 'output') {
                layer.open({
                    type: 2,
                    title: 'ã€' + data.name + ' ' + data.code + 'ã€‘ çš„åº“å­˜ä¿¡æ¯',
                    area: ['800px', '590px'],
                    scrollbar: false,
                    content: ['/toStockData/' + data.id, 'no']
                });
            }
        });

        // è¡Œå•å‡»äº‹ä»¶
        table.on('row(test)', function (obj) {
            layer.msg('ç‚¹å‡»ï¼š' + obj.data.id);
            //layer.closeAll('tips');
        });
    });
</script>
</body>
</html>